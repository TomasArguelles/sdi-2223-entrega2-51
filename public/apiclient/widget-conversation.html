<div id="widget-detalles">
    <div class="form-group"><label class="control-label col-sm-2" for="title">Titulo:</label>
        <div class="col-sm-10"><input type="text" class="form-control" name="title" placeholder="Título de la oferta"
                                      id="title" readonly/></div>
    </div>
    <div class="form-group"><label class="control-label col-sm-2" for="kind">Descripción:</label>
        <div class="col-sm-10"><input type="text" class="form-control" name="kind" placeholder="Descripción de la oferta"
                                      id="kind" readonly/></div>
    </div>
    <div class="form-group"><label class="control-label col-sm-2" for="price">Precio (€):</label>
        <div class="col-sm-10"><input type="number" step="0.01" class="form-control" name="price" placeholder="2.50"
                                      id="price" readonly/></div>
    </div>
    <button onclick="widgetSongs()" class="btn">Volver</button>

    <div>
        <div class="media col-xs-10">
            <div>
                <h2>Conversación:
                    <div>
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>Autor</th>
                                <th>Mensaje</th>
                                <th>Leido</th>
                            </tr>
                            </thead>
                            <tbody id="messagesTableBody">

                            </tbody>
                        </table>
                    </div>
                </h2>

                <form class="media-body" method="post" encType="multipart/form-data">
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="text">Mensaje:</label>
                        <div class="col-sm-10">
                            <input id="text" type="text" class="form-control" name="text" placeholder="Mensaje"
                                   required="true"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" onclick="addMessages()" class="btn btn-primary">Enviar</button>
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>
<script>
    let messages;

    function loadAllMessages(){

       $.ajax({
           url: URLbase + "/messages/" + selectedId,
           type : "GET",
           data: {idOffer: selectedId}, // creo q aqui va el comprador
           dataType: 'json',
           headers: {
               "token" : token
           },
           success: function (response){
                messages = response.messages;
                console.log(messages);
                updateMessages(messages);
           },error: function (error){

           }
       });
    }

    function updateMessages(messages){
        $("#messagesTableBody").empty();
        if(messages.length === 0){
            $("#messagesTableBody").append(
                "<tr>" +
                "<td colspan='5'>No hay mensajes disponibles</td>" +
                "</tr>");
        }else{
            for(let i = 0; i<messages.length; i++){
                $("#messagesTableBody").append(
                    "<tr>" +
                    "<td>"+ messages[i].idSender +"</td>" +
                    "<td>"+ messages[i].texto +"</td>" +
                    "<td>"+ messages[i].leido +"</td>" +
                    "</tr>"
                );
            }
        }
    }

    function addMessages(){
        $.ajax({
            url: URLbase + "/messages/add",
            type: "POST",
            data: {
                idOffer: selectedId,
                idReceiver: offer.seller,
                texto: $("#text").val()
            },
            dataType: 'json',
            headers: {
                "token": token
            },
            success: function (response) {
                console.log("añadido");
            }, error: function (error) {

            }
        })
    }

    loadAllMessages();
</script>